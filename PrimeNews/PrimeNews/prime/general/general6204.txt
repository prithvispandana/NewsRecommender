The battle has taken nine months, left large areas in ruins and thousands of civilians.