England slump to a 340-run defeat by South Africa on day four of the second Test at Trent Bridge.